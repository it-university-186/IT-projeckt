name: Quiz Auto Check

on:
  push:
    paths:
      - 'students/**/quiz_*answers.md'
  pull_request:
    paths:
      - 'students/**/quiz_*answers.md'

permissions:
  contents: write

jobs:
  quiz-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²
        run: |
          mkdir -p grades
          echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹..."
          
          for quiz in $(ls tests/quiz_*.md); do
            quiz_name=$(basename $quiz)
            echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ $quiz_name"
            
            for answer in $(find students -name "${quiz_name/quiz_/quiz_*answers.md}" 2>/dev/null); do
              correct=$(grep -c "âœ…" "$answer" || true)
              total=$(grep -c "^[0-9]" "$quiz" || true)
              echo "$(date +'%Y-%m-%d'),${answer},${correct}/${total}" >> grades/quiz_results.csv
              echo "âœ… $answer â€” $correct Ð¸Ð· $total"
            done
          done

      - name: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð° summary.md
        run: |
          echo "# Ð˜Ñ‚Ð¾Ð³Ð¸ Ñ‚ÐµÑÑ‚Ð¾Ð² ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ð¾Ð²" > grades/summary.md
          echo "" >> grades/summary.md
          echo "| Ð”Ð°Ñ‚Ð° | Ð¤Ð°Ð¹Ð» | Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ |" >> grades/summary.md
          echo "|------|-------|------------|" >> grades/summary.md
          cat grades/quiz_results.csv | while IFS=, read -r date file result; do
            echo "| $date | $file | $result |" >> grades/summary.md
          done
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add grades/summary.md
          git commit -m "update summary [skip ci]" || echo "No changes"
          git push
